#!/bin/sh
#
# Move Windows around the right way
#

dir=$1

opposite_dir() {
    case "$1" in
        west) echo "east"
            ;;
        east) echo "west"
            ;;
        north) echo "south"
            ;;
        south) echo "north"
            ;;
    esac
}

# Return the direction 90 degrees from selected direction
border_dir() {
    case "$1" in
        west) if bspc query -N -n south.local >/dev/null ; then
                  echo "south"
              else
                  echo "north"
              fi
            ;;
        east) if bspc query -N -n south.local >/dev/null ; then
                  echo "south"
              else
                  echo "north"
              fi
            ;;
        north) if bspc query -N -n west.local >/dev/null ; then
                  echo "west"
              else
                  echo "east"
              fi
            ;;
        south) if bspc query -N -n east.local >/dev/null ; then
                  echo "east"
              else
                  echo "west"
              fi
            ;;
    esac
}


# IF window is at border of monitor and there is an adjecent monitor
# THEN move window to there
if bspc query -M -m ${dir} && ! bspc query -N -n ${dir}.local && bspc query -N -n ${dir}; then
  # Split vertically when there is only one window on the lower screen
  # else split horizontally
  if [ "$(bspc query -N -d ${dir}:focused | wc -l)" -eq "1" ] ; then
    bspc node ${dir} -p $(border_dir ${dir}) && bspc node -m ${dir} --follow
  else
    bspc node ${dir} -p $(opposite_dir ${dir}) && bspc node -m ${dir} --follow
  fi

# IF no window is on next monitor move window to it
elif bspc query -M -m ${dir} && ! bspc query -N -n ${dir}.local ; then
    bspc node -m ${dir} --follow
    
# IF at border of monitor and there is no adjecent monitor
# THEN rotate split by 90 degree
elif ! bspc query -N -n ${dir}.local ; then
    bspc node $(border_dir ${dir}) -p ${dir} && bspc node -n $(border_dir ${dir}).local

# ELSE switch with adjecent window
else
    bspc node -s ${dir}
fi
